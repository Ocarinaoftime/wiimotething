!function(e,t,s,o,r){var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i="function"==typeof n[o]&&n[o],a=i.cache||{},c="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function l(t,s){if(!a[t]){if(!e[t]){var r="function"==typeof n[o]&&n[o];if(!s&&r)return r(t,!0);if(i)return i(t,!0);if(c&&"string"==typeof t)return c(t);var d=new Error("Cannot find module '"+t+"'");throw d.code="MODULE_NOT_FOUND",d}y.resolve=function(s){var o=e[t][1][s];return null!=o?o:s},y.cache={};var h=a[t]=new l.Module(t);e[t][0].call(h.exports,y,h,h.exports,this)}return a[t].exports;function y(e){var t=y.resolve(e);return!1===t?{}:l(t)}}l.isParcelRequire=!0,l.Module=function(e){this.id=e,this.bundle=l,this.exports={}},l.modules=e,l.cache=a,l.parent=i,l.register=function(t,s){e[t]=[function(e,t){t.exports=s},{}]},Object.defineProperty(l,"root",{get:function(){return n[o]}}),n[o]=l;for(var d=0;d<t.length;d++)l(t[d]);if(s){var h=l(s);"object"==typeof exports&&"undefined"!=typeof module?module.exports=h:"function"==typeof define&&define.amd&&define((function(){return h}))}}({"3gymj":[function(e,t,s){var o=e("./index");window.keystrokes=o},{"./index":"geiQx"}],geiQx:[function(e,t,s){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(s),o.export(s,"Keystrokes",(()=>n.Keystrokes)),o.export(s,"setGlobalKeystrokes",(()=>c)),o.export(s,"getGlobalKeystrokes",(()=>l)),o.export(s,"setGlobalKeystrokesOptions",(()=>d)),o.export(s,"bindKey",(()=>h)),o.export(s,"unbindKey",(()=>y)),o.export(s,"bindKeyCombo",(()=>u)),o.export(s,"unbindKeyCombo",(()=>f)),o.export(s,"checkKey",(()=>m)),o.export(s,"checkKeyCombo",(()=>p)),o.export(s,"normalizeKeyCombo",(()=>_)),o.export(s,"stringifyKeyCombo",(()=>b)),o.export(s,"parseKeyCombo",(()=>K)),o.export(s,"createTestKeystrokes",(()=>C));var r=e("./key-combo-state"),n=e("./keystrokes");let i,a;const c=e=>{a=e??new(0,n.Keystrokes)(i)},l=()=>(a||c(),a),d=e=>{i=e},h=(...e)=>l().bindKey(...e),y=(...e)=>l().unbindKey(...e),u=(...e)=>l().bindKeyCombo(...e),f=(...e)=>l().unbindKeyCombo(...e),m=(...e)=>l().checkKey(...e),p=(...e)=>l().checkKeyCombo(...e),_=r.KeyComboState.normalizeKeyCombo,b=r.KeyComboState.stringifyKeyCombo,K=r.KeyComboState.parseKeyCombo,C=()=>{let e,t,s,o;return Object.assign(new(0,n.Keystrokes)({onActive(t){e=t},onInactive(e){t=e},onKeyPressed(e){s=e},onKeyReleased(e){o=e}}),{activate:e,deactivate:t,press:s,release:o})}},{"./key-combo-state":"5Tr86","./keystrokes":"bJP3g","@parcel/transformer-js/src/esmodule-helpers.js":"f66dl"}],"5Tr86":[function(e,t,s){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(s),o.export(s,"KeyComboState",(()=>a));var r=e("@swc/helpers/src/_define_property.mjs"),n=o.interopDefault(r),i=e("./handler-state");class a{static parseKeyCombo(e){if(a._parseCache[e])return a._parseCache[e];const t=e.toLowerCase();let s="",o=[],r=[o],n=[r];const i=[n];let c=!1;for(let a=0;a<e.length;a+=1)"\\"===t[a]?c=!0:"+"!==t[a]&&">"!==t[a]&&","!==t[a]||c?t[a].match(/[^\s]/)&&(s&&(","===s?(o=[],r=[o],n=[r],i.push(n)):">"===s?(o=[],r=[o],n.push(r)):"+"===s&&(o=[],r.push(o)),s=""),c=!1,o.push(t[a])):s=t[a];const l=i.map((e=>e.map((e=>e.map((e=>e.join("")))))));return a._parseCache[e]=l,l}static stringifyKeyCombo(e){return e.map((e=>e.map((e=>e.map((e=>"+"===e?"\\+":">"===e?"\\>":","===e?"\\,":e)).join("+"))).join(">"))).join(",")}static normalizeKeyCombo(e){if(a._normalizationCache[e])return a._normalizationCache[e];const t=this.stringifyKeyCombo(this.parseKeyCombo(e));return a._normalizationCache[e]=t,t}get isPressed(){return!!this._isPressedWithFinalKey}isOwnHandler(e){return this._handlerState.isOwnHandler(e)}executePressed(e){this._isPressedWithFinalKey===e.key&&this._handlerState.executePressed(this._wrapEvent(e))}executeReleased(e){this._isPressedWithFinalKey===e.key&&(this._isPressedWithFinalKey="",this._handlerState.executeReleased(this._wrapEvent(e)))}updateState(e){const t=this._parsedKeyCombo[this._sequenceIndex];if(0===e.length)return;let s=0;for(const o of t){let t=s;for(const r of o){let o=!1;for(let n=s;n<e.length;n+=1){if(r===e[n]){n>t&&(t=n),o=!0;break}}if(!o)return void(this._handlerState.isEmpty&&(this._isPressedWithFinalKey=""))}s=t}for(const s of e){let e=!1;for(const o of t)for(const t of o)if(s===t){e=!0;break}if(!e)return void(this._sequenceIndex=0)}this._sequenceIndex<this._parsedKeyCombo.length-1?this._sequenceIndex+=1:(this._sequenceIndex=0,this._isPressedWithFinalKey=e[e.length-1])}_wrapEvent(e){return{keyCombo:this._normalizedKeyCombo,originalEvent:e.originalEvent}}constructor(e,t={}){this._normalizedKeyCombo=a.normalizeKeyCombo(e),this._parsedKeyCombo=a.parseKeyCombo(e),this._handlerState=new(0,i.HandlerState)(t),this._isPressedWithFinalKey="",this._sequenceIndex=0}}(0,n.default)(a,"_parseCache",{}),(0,n.default)(a,"_normalizationCache",{})},{"@swc/helpers/src/_define_property.mjs":"eRMBM","./handler-state":"aKDhB","@parcel/transformer-js/src/esmodule-helpers.js":"f66dl"}],eRMBM:[function(e,t,s){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(s),s.default=function(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f66dl"}],f66dl:[function(e,t,s){s.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},s.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.exportAll=function(e,t){return Object.keys(e).forEach((function(s){"default"===s||"__esModule"===s||t.hasOwnProperty(s)||Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[s]}})})),t},s.export=function(e,t,s){Object.defineProperty(e,t,{enumerable:!0,get:s})}},{}],aKDhB:[function(e,t,s){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(s),o.export(s,"HandlerState",(()=>r));class r{get isEmpty(){return!this._onPressed&&!this._onPressedWithRepeat&&!this._onReleased}isOwnHandler(e){return this._identity===e}executePressed(e){this._isPressed||this._onPressed?.(e),this._isPressed=!0,this._onPressedWithRepeat?.(e)}executeReleased(e){this._isPressed&&this._onReleased?.(e),this._isPressed=!1}constructor(e){this._isPressed=!1,this._identity=e,"function"==typeof e?this._onPressedWithRepeat=e:(this._onPressed=e.onPressed,this._onPressedWithRepeat=e.onPressedWithRepeat,this._onReleased=e.onReleased)}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f66dl"}],bJP3g:[function(e,t,s){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(s),o.export(s,"nextTick",(()=>a)),o.export(s,"Keystrokes",(()=>y));var r=e("./handler-state"),n=e("./key-combo-state");const i="function"==typeof requestAnimationFrame?e=>requestAnimationFrame(e):e=>setTimeout(e,0),a=()=>new Promise((e=>i(e))),c=e=>{try{const t=()=>e();return addEventListener("focus",t),()=>{removeEventListener("focus",t)}}catch{}},l=e=>{try{const t=()=>e();return addEventListener("blur",t),()=>{removeEventListener("blur",t)}}catch{}},d=e=>{try{const t=t=>e({key:t.key,originalEvent:t});return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}}catch{}},h=e=>{try{const t=t=>e({key:t.key,originalEvent:t});return document.addEventListener("keyup",t),()=>{document.removeEventListener("keyup",t)}}catch{}};class y{get pressedKeys(){return this._activeKeys.slice(0)}bindKey(e,t){e=e.toLowerCase();const s=new(0,r.HandlerState)(t);this._handlerStates[e]??=[],this._handlerStates[e].push(s)}unbindKey(e,t){e=e.toLowerCase();const s=this._handlerStates[e];if(s)if(t)for(let e=0;e<s.length;e+=1)s[e].isOwnHandler(t)&&(s.splice(e,1),e-=1);else s.length=0}bindKeyCombo(e,t){e=n.KeyComboState.normalizeKeyCombo(e);const s=new(0,n.KeyComboState)(e,t);this._keyComboStates[e]??=[],this._keyComboStates[e].push(s),this._keyComboStatesArray.push(s)}unbindKeyCombo(e,t){e=n.KeyComboState.normalizeKeyCombo(e);const s=this._keyComboStates[e];if(s)if(t){for(let e=0;e<s.length;e+=1)if(s[e].isOwnHandler(t)){for(let t=0;t<this._keyComboStatesArray.length;t+=1)this._keyComboStatesArray[t]===s[e]&&(this._keyComboStatesArray.splice(t,1),t-=1);s.splice(e,1),e-=1}}else s.length=0}checkKey(e){return this._activeKeySet.has(e.toLowerCase())}checkKeyCombo(e){e=n.KeyComboState.normalizeKeyCombo(e),this._watchedKeyComboStates[e]||(this._watchedKeyComboStates[e]=new(0,n.KeyComboState)(e));const t=this._watchedKeyComboStates[e];return t.updateState(this._activeKeys),t.isPressed}bindEnvironment(){this.unbindEnvironment();const e=this._onActiveBinder((()=>{this._isActive=!0})),t=this._onInactiveBinder((()=>{this._isActive=!1})),s=this._onKeyPressedBinder((e=>{this._handleKeyPress(e)})),o=this._onKeyReleasedBinder((e=>{this._handleKeyRelease(e)}));this._unbinder=()=>{e?.(),t?.(),s?.(),o?.()}}unbindEnvironment(){this._unbinder?.()}_handleKeyPress(e){(async()=>{if(!this._isActive)return;let t=e.key.toLowerCase();const s=this._keyRemap[t];s&&(t=s);const o=this._handlerStates[t];if(o)for(const t of o)t.executePressed(e);this._activeKeySet.has(t)||(this._activeKeySet.add(t),this._activeKeys.push(t)),await this._updateKeyComboStates();for(const t of this._keyComboStatesArray)t.executePressed(e)})().catch((e=>{console.error(e)}))}_handleKeyRelease(e){(async()=>{const t=e.key.toLowerCase(),s=this._handlerStates[t];if(s)for(const t of s)t.executeReleased(e);if(this._activeKeySet.has(t)){this._activeKeySet.delete(t);for(let e=0;e<this._activeKeys.length;e+=1)if(this._activeKeys[e]===t){this._activeKeys.splice(e,1),e-=1;break}}this._tryReleaseSelfReleasingKeys(),await this._updateKeyComboStates();for(const t of this._keyComboStatesArray)t.executeReleased(e)})().catch((e=>{console.error(e)}))}async _updateKeyComboStates(){if(this._isUpdatingKeyComboState)return await a();this._isUpdatingKeyComboState=!0,await a();for(const e of this._keyComboStatesArray)e.updateState(this._activeKeys);this._isUpdatingKeyComboState=!1}_tryReleaseSelfReleasingKeys(){for(const e of this._activeKeys){let t=!1;for(const s of this._selfReleasingKeys)if(e===s){t=!0;break}if(!t)return}for(const e of this._activeKeys)this._handleKeyRelease({key:e})}constructor(e={}){this._isActive=!0,this._isUpdatingKeyComboState=!1,this._onActiveBinder=e.onActive??c,this._onInactiveBinder=e.onInactive??l,this._onKeyPressedBinder=e.onKeyPressed??d,this._onKeyReleasedBinder=e.onKeyReleased??h,this._selfReleasingKeys=e.selfReleasingKeys??[],this._keyRemap=e.keyRemap??{},this._handlerStates={},this._keyComboStates={},this._keyComboStatesArray=[],this._activeKeys=[],this._activeKeySet=new Set,this._watchedKeyComboStates={},this.bindEnvironment()}}},{"./handler-state":"aKDhB","./key-combo-state":"5Tr86","@parcel/transformer-js/src/esmodule-helpers.js":"f66dl"}]},["3gymj"],"3gymj","parcelRequirefbeb");
//# sourceMappingURL=keystrokes.js.map
